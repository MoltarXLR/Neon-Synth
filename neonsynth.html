<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SYNTH</title>
<style>
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  margin: 0;
  padding: 0;
}
html, body {
  background: #f2f1ef;
  font-family: 'Courier New', monospace;
  color: #333;
  height: 100%;
  width: 100%;
  overflow: hidden;
  position: fixed;
  top: 0;
  left: 0;
}

/* ====== LAYOUT ====== */
.shell {
  display: -webkit-flex;
  display: flex;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
  height: 100%;
  width: 100%;
  position: fixed;
  top: 0;
  left: 0;
}

/* Top-left: Controls */
.panel-controls {
  width: 50%;
  height: 50%;
  padding: 16px;
  position: relative;
  overflow: hidden;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
}
.panel-controls::after {
  content: "";
  position: absolute;
  right: 0;
  top: 10%;
  height: 80%;
  width: 1px;
  background: -webkit-linear-gradient(top, transparent, #ccc, transparent);
  background: linear-gradient(to bottom, transparent, #ccc, transparent);
}

/* Top-right: Visualizer */
.panel-viz {
  width: 50%;
  height: 50%;
  position: relative;
  overflow: hidden;
}
#visualizer {
  display: block;
  width: 100%;
  height: 100%;
  /* GPU compositing layer — prevents Safari raster on every draw */
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  will-change: transform;
}

/* Bottom: Keys area */
.panel-keys {
  width: 100%;
  height: 50%;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  -webkit-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  align-items: center;
  position: relative;
  padding: 20px;
}
.panel-keys::before {
  content: "";
  position: absolute;
  left: 5%;
  top: 0;
  width: 90%;
  height: 1px;
  background: -webkit-linear-gradient(left, transparent, #ccc, transparent);
  background: linear-gradient(to right, transparent, #ccc, transparent);
}

/* ====== CONTROL PANEL ====== */
.ctrl-title {
  font-size: 0.55rem;
  letter-spacing: 5px;
  text-transform: uppercase;
  color: #999;
  margin-bottom: 12px;
}

.knobs-grid {
  display: -webkit-flex;
  display: flex;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
  -webkit-justify-content: center;
  justify-content: center;
  -webkit-flex: 1;
  flex: 1;
  -webkit-align-content: center;
  align-content: center;
}

.knob-unit {
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  justify-content: center;
  width: 48%;
  max-width: 160px;
  padding: 12px 8px;
  margin: 3px 1%;
  background: rgba(0,0,0,0.02);
  border: 1px solid #d0d0d0;
  border-radius: 3px;
}
.knob-label {
  font-size: 0.5rem;
  letter-spacing: 3px;
  color: #888;
  text-transform: uppercase;
  margin-bottom: 6px;
}
.knob-canvas {
  display: block;
  width: 80px;
  height: 80px;
}
.knob-value {
  font-size: 0.7rem;
  color: #333;
  margin-top: 6px;
  min-height: 16px;
  font-weight: bold;
}

/* ====== KEYS ====== */
.keys-row {
  display: -webkit-flex;
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  -webkit-justify-content: center;
  justify-content: center;
}
.key {
  background: #fff;
  border: 1px solid #bbb;
  color: #444;
  padding: 0;
  width: 80px;
  height: 80px;
  font-size: 1.3rem;
  font-family: 'Courier New', monospace;
  font-weight: bold;
  border-radius: 4px;
  outline: none;
  -webkit-appearance: none;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  -webkit-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  align-items: center;
  position: relative;
  overflow: hidden;
}
.key::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: transparent;
}
.key span {
  font-size: 0.5rem;
  display: block;
  margin-top: 4px;
  opacity: 0.4;
}

/* ====== TRANSPORT ====== */
.transport-row {
  display: -webkit-flex;
  display: flex;
  gap: 10px;
  -webkit-align-items: center;
  align-items: center;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
  -webkit-justify-content: center;
  justify-content: center;
}
.btn-transport {
  background: #fff;
  border: 1px solid #bbb;
  color: #888;
  font-family: 'Courier New', monospace;
  font-size: 0.65rem;
  font-weight: bold;
  letter-spacing: 3px;
  padding: 12px 28px;
  border-radius: 3px;
  outline: none;
  -webkit-appearance: none;
}
.btn-transport.drums-on {
  border-color: #b8860b;
  color: #b8860b;
  background: #fdf8ee;
}

.led {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #ccc;
  border: 1px solid #aaa;
}
.led.on-amber {
  background: #b8860b;
  -webkit-box-shadow: 0 0 6px rgba(184,134,11,0.4);
  box-shadow: 0 0 6px rgba(184,134,11,0.4);
  border-color: #b8860b;
}
</style>
</head>
<body>

<div class="shell">

  <!-- TOP LEFT: Controls -->
  <div class="panel-controls">
    <div class="ctrl-title">Parameters</div>
    <div class="knobs-grid">
      <div class="knob-unit" id="unit-tempo">
        <div class="knob-label">Tempo</div>
        <canvas class="knob-canvas" id="knob-tempo" width="160" height="160"></canvas>
        <div class="knob-value" id="val-tempo">120 BPM</div>
      </div>
      <div class="knob-unit" id="unit-delay">
        <div class="knob-label">Delay</div>
        <canvas class="knob-canvas" id="knob-delay" width="160" height="160"></canvas>
        <div class="knob-value" id="val-delay">0%</div>
      </div>
      <div class="knob-unit" id="unit-reverb">
        <div class="knob-label">Reverb</div>
        <canvas class="knob-canvas" id="knob-reverb" width="160" height="160"></canvas>
        <div class="knob-value" id="val-reverb">0%</div>
      </div>
      <div class="knob-unit" id="unit-drive">
        <div class="knob-label">Drive</div>
        <canvas class="knob-canvas" id="knob-drive" width="160" height="160"></canvas>
        <div class="knob-value" id="val-drive">0%</div>
      </div>
    </div>
  </div>

  <!-- TOP RIGHT: Pyramid -->
  <div class="panel-viz">
    <canvas id="visualizer"></canvas>
  </div>

  <!-- BOTTOM: Keys + Transport -->
  <div class="panel-keys">
    <div class="keys-row">
      <button class="key" id="key-4">G<span>E2</span></button>
      <button class="key" id="key-5">H<span>G#2</span></button>
      <button class="key" id="key-0">A<span>C#3</span></button>
      <button class="key" id="key-1">S<span>E3</span></button>
      <button class="key" id="key-2">D<span>G#3</span></button>
      <button class="key" id="key-3">F<span>B3</span></button>
    </div>
    <div class="transport-row">
      <div class="led on-amber" id="drums-led"></div>
      <button class="btn-transport drums-on" id="drums-btn">DRUMS</button>
      <div class="led" id="hold-led"></div>
      <button class="btn-transport" id="hold-btn">HOLD</button>
      <button class="btn-transport" id="stop-btn">STOP</button>
    </div>
  </div>

</div>

<script>
(function () {
  "use strict";

  // ====== STATIC KNOB RENDER ======

  var params = {
    tempo: 0.38,
    delay: 0,
    reverb: 0,
    drive: 0
  };

  var knobConfigs = [
    { id: "tempo",  param: "tempo",  valId: "val-tempo",
      format: function (v) { return Math.round(60 + v * 140) + " BPM"; }, color: "#2a2a2a" },
    { id: "delay",  param: "delay",  valId: "val-delay",
      format: function (v) { return Math.round(v * 100) + "%"; }, color: "#b8860b" },
    { id: "reverb", param: "reverb", valId: "val-reverb",
      format: function (v) { return Math.round(v * 100) + "%"; }, color: "#2d6da4" },
    { id: "drive",  param: "drive",  valId: "val-drive",
      format: function (v) { return Math.round(v * 100) + "%"; }, color: "#c0392b" }
  ];

  function drawKnob(cfg) {
    var canvas = document.getElementById("knob-" + cfg.id);
    var c = canvas.getContext("2d");
    var v = params[cfg.param];
    var cx = 80, cy = 80, r = 56;
    var startAngle = 0.75 * Math.PI;

    c.clearRect(0, 0, 160, 160);

    // Track background
    c.beginPath();
    c.arc(cx, cy, r, startAngle, 0.25 * Math.PI, false);
    c.lineWidth = 6;
    c.strokeStyle = "#ddd";
    c.stroke();

    // Active arc
    if (v > 0.005) {
      c.beginPath();
      c.arc(cx, cy, r, startAngle, startAngle + v * 1.5 * Math.PI, false);
      c.lineWidth = 6;
      c.strokeStyle = cfg.color;
      c.stroke();
    }

    // Knob body
    c.beginPath();
    c.arc(cx, cy, 36, 0, 2 * Math.PI);
    c.fillStyle = "#fff";
    c.strokeStyle = "#bbb";
    c.lineWidth = 2;
    c.fill();
    c.stroke();

    // Indicator line
    var indAngle = startAngle + v * 1.5 * Math.PI;
    c.beginPath();
    c.moveTo(cx + Math.cos(indAngle) * 16, cy + Math.sin(indAngle) * 16);
    c.lineTo(cx + Math.cos(indAngle) * 33, cy + Math.sin(indAngle) * 33);
    c.lineWidth = 4;
    c.strokeStyle = cfg.color;
    c.lineCap = "round";
    c.stroke();
    c.lineCap = "butt";

    document.getElementById(cfg.valId).textContent = cfg.format(v);
    document.getElementById(cfg.valId).style.color = cfg.color;
  }

  // ====== NEON GREEN PYRAMID ======

  var vizCanvas = document.getElementById("visualizer");
  var vizCtx = vizCanvas.getContext("2d");
  var NEON = "#39ff14";

  function drawPyramid() {
    var parent = vizCanvas.parentNode;
    var w = parent.clientWidth;
    var h = parent.clientHeight;

    // Set backing-store dimensions once per resize — avoids per-frame thrash
    vizCanvas.width = w;
    vizCanvas.height = h;

    var cx   = w / 2;
    var apexX = cx,  apexY = h * 0.14;
    var baseY = h * 0.82;
    var baseL = w * 0.12, baseR = w * 0.88;

    // Background
    vizCtx.fillStyle = "#f2f1ef";
    vizCtx.fillRect(0, 0, w, h);

    // Draw pyramid with layered glow passes
    // (outermost glow first, solid edge last)
    var passes = [
      { blur: 32, lineWidth: 14, alpha: 0.10 },
      { blur: 18, lineWidth:  9, alpha: 0.22 },
      { blur:  8, lineWidth:  5, alpha: 0.50 },
      { blur:  0, lineWidth:  2, alpha: 1.00 }
    ];

    for (var i = 0; i < passes.length; i++) {
      var p = passes[i];
      vizCtx.save();
      vizCtx.globalAlpha    = p.alpha;
      vizCtx.strokeStyle    = NEON;
      vizCtx.shadowColor    = NEON;
      vizCtx.shadowBlur     = p.blur;
      vizCtx.lineWidth      = p.lineWidth;
      vizCtx.lineJoin       = "round";
      vizCtx.lineCap        = "round";
      vizCtx.beginPath();
      vizCtx.moveTo(apexX, apexY);
      vizCtx.lineTo(baseR, baseY);
      vizCtx.lineTo(baseL, baseY);
      vizCtx.closePath();
      vizCtx.stroke();
      vizCtx.restore();
    }

    // Very subtle neon fill
    vizCtx.save();
    vizCtx.globalAlpha = 0.05;
    vizCtx.fillStyle = NEON;
    vizCtx.beginPath();
    vizCtx.moveTo(apexX, apexY);
    vizCtx.lineTo(baseR, baseY);
    vizCtx.lineTo(baseL, baseY);
    vizCtx.closePath();
    vizCtx.fill();
    vizCtx.restore();
  }

  // ====== INIT ======

  for (var i = 0; i < knobConfigs.length; i++) {
    drawKnob(knobConfigs[i]);
  }

  drawPyramid();

  // Redraw only on resize — no continuous rAF loop needed
  window.addEventListener("resize", drawPyramid, false);

})();
</script>
</body>
</html>
